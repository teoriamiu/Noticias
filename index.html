<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diario Noticias, üåç </title>
  
  <!-- SEO -->
  <meta name="description" content="Sitio moderno con noticias actualizadas.">
  <meta name="keywords" content="Diario Noticias">
  <meta name="author" content="Agust√≠n D√≠az">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://diario-noticias.netlify.app/">
  
  <!-- SEO Redes Sociales -->
  <meta property="og:title" content="Diario Noticias">
  <meta property="og:description" content="Noticias al instante.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://via.placeholder.com/1200x630.png?text=Mi+Web+Integrada">
  
  <meta property="og:title" content="¬°El Super Alacr√°n Ha Llegado! ü¶Çüî•">
  <meta property="og:description" content="Descubre todo sobre el incre√≠ble Super Alacr√°n: su origen, poderes y la leyenda que lo rodea. ¬°Una criatura √©pica te espera!">
  <meta property="og:image" content="https://i.imgur.com/DApJ91v.jpeg">
  <meta property="og:url" content="https://diario-noticias.netlify.app/">
  <meta property="og:type" content="website">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="¬°El Super Alacr√°n Ha Llegado! ü¶Çüî•">
  <meta name="twitter:description" content="Descubre todo sobre el incre√≠ble Super Alacr√°n: su origen, poderes y la leyenda que lo rodea. ¬°Una criatura √©pica te espera!">
  <meta name="twitter:image" content="https://i.imgur.com/DApJ91v.jpeg">

  <style>
    :root { --g: 12px; --primary: #111; --muted: #666; }
    html,body { margin:0; padding:0; background:#fff; font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--primary); }
    body { max-width:980px; margin:auto; padding:24px; }
    h1 { margin:0; font-size:22px; font-weight:600; }
    header { display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; gap:12px; margin-bottom:18px; }
    input[type="search"]{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:14px;min-width:220px;}
    button{padding:8px 12px;border:0;border-radius:8px;background:var(--primary);color:#fff;cursor:pointer;font-size:14px;}
    .cats{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px;}
    .cats button{background:#fafafa;color:var(--primary);border:1px solid #eee;padding:6px 10px;font-size:13px;border-radius:8px;cursor:pointer;transition:all .15s;}
    .cats button:hover{transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,0.04);}
    .cats button.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:var(--g);}
    .card{border:1px solid #eee;border-radius:10px;padding:12px;background:#fff;display:flex;flex-direction:column;gap:8px;}
    .card img{width:100%;height:140px;object-fit:cover;border-radius:6px;}
    .title{font-weight:600;font-size:15px;}
    .meta{font-size:12px;color:var(--muted);}
    #status{margin:14px 0;color:#444;}
    footer{margin-top:20px;font-size:13px;color:var(--muted);}
    .small{font-size:13px;color:var(--muted);}
  </style>
</head>

<body>
  <header>
    <h1>Noticias ‚Äî GNews</h1>

    <div style="display:flex;gap:8px;align-items:center;">
      <input id="q" type="search" placeholder="Buscar (puede ser categor√≠a: Salud, Deportes, Tecnolog√≠a...)" />
      <button id="btnBuscar">Buscar</button>
    </div>
  </header>

  <div class="cats" id="cats"></div>

  <div id="status">Cargando...</div>

  <main>
    <div id="list" class="grid"></div>
  </main>

  <footer><span id="info">‚Äî</span></footer>

  <script>
    // Mapa: etiqueta en espa√±ol -> c√≥digo en ingl√©s que usa la API
    const CATEGORY_MAP = {
      "Negocios": "business",
      "Entretenimiento": "entertainment",
      "General": "general",
      "Salud": "health",
      "Ciencia": "science",
      "Deportes": "sports",
      "Tecnolog√≠a": "technology"
    };

    // Indexado auxiliar para detecci√≥n por texto (min√∫sculas)
    const SPANISH_TO_EN = {};
    Object.keys(CATEGORY_MAP).forEach(k => {
      SPANISH_TO_EN[k.toLowerCase()] = CATEGORY_MAP[k];
    });

    const qInput = document.getElementById("q");
    const btnBuscar = document.getElementById("btnBuscar");
    const cats = document.getElementById("cats");
    const status = document.getElementById("status");
    const list = document.getElementById("list");
    const info = document.getElementById("info");

    // Estado UI
    let activeCategory = "general"; // c√≥digo en ingl√©s
    let activeLabel = "General";    // etiqueta en espa√±ol

    // Render botones de categor√≠as (etiqueta en espa√±ol)
    Object.keys(CATEGORY_MAP).forEach(label => {
      const b = document.createElement("button");
      b.textContent = label;
      b.dataset.cat = CATEGORY_MAP[label]; // c√≥digo en ingl√©s
      b.onclick = () => {
        // marcar activo visualmente y cargar
        setActiveButton(b);
        load(CATEGORY_MAP[label], label);
      };
      cats.appendChild(b);
    });

    // Marca el bot√≥n activo (clase .active)
    function setActiveButton(btn) {
      const all = cats.querySelectorAll("button");
      all.forEach(x => x.classList.remove("active"));
      if (btn) btn.classList.add("active");
    }

    // Intento de interpretar la b√∫squeda:
    // - Si coincide exactamente (ignorando may√∫sculas) con una categor√≠a en espa√±ol -> usamos esa categor√≠a (c√≥digo en ingl√©s)
    // - Si no, enviamos la b√∫squeda como texto libre a la API
    function interpretQuery(raw) {
      if (!raw) return { type: "category", q: "general", label: "General" }; // default
      const s = raw.trim().toLowerCase();
      // coincidencia exacta (palabra sola o etiqueta)
      if (SPANISH_TO_EN[s]) {
        // categor√≠a detectada
        // devolver c√≥digo en ingl√©s y etiqueta original capitalizada desde el mapa
        const code = SPANISH_TO_EN[s];
        // buscar label original (capitalizado) desde CATEGORY_MAP
        const label = Object.keys(CATEGORY_MAP).find(k => CATEGORY_MAP[k] === code) || raw;
        return { type: "category", q: code, label };
      }
      // coincidencia parcial: si una palabra dentro coincide (ej. "noticias salud" -> salud)
      const tokens = s.split(/\s+/);
      for (const t of tokens) {
        if (SPANISH_TO_EN[t]) {
          const code = SPANISH_TO_EN[t];
          const label = Object.keys(CATEGORY_MAP).find(k => CATEGORY_MAP[k] === code) || t;
          return { type: "category", q: code, label };
        }
      }
      // si no encontramos categor√≠a, devolvemos texto libre (query)
      return { type: "query", q: raw.trim(), label: `B√∫squeda: "${raw.trim()}"` };
    }

    // Fetch hacia tu funci√≥n Netlify (ruta que ten√≠as)
    async function fetchNews(q) {
      const url = `/.netlify/functions/news?q=${encodeURIComponent(q)}`;
      const r = await fetch(url);
      if (!r.ok) throw new Error("Backend error " + r.status);
      return await r.json();
    }

    function render(articles) {
      list.innerHTML = "";
      if (!articles || articles.length === 0) {
        status.textContent = "No hay resultados.";
        info.textContent = "0 resultados";
        return;
      }
      status.textContent = "";
      info.textContent = `Mostrando ${articles.length} noticias ‚Äî ${activeLabel}`;
      articles.forEach(a => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          ${a.image ? `<img src="${a.image}" alt="">` : ""}
          <div class="title"><a href="${a.url}" target="_blank" rel="noopener noreferrer">${a.title}</a></div>
          <div class="meta">${a.source?.name || ""}${a.publishedAt ? " ¬∑ " + new Date(a.publishedAt).toLocaleString() : ""}</div>
          <div>${a.description || ""}</div>
        `;
        list.appendChild(el);
      });
    }

    // Carga principal: puede recibir q que sea c√≥digo en ingl√©s (categor√≠a) o texto libre.
    // activeLabel es la etiqueta que mostramos en UI (espa√±ol o texto b√∫squeda).
    async function load(q = "general", label = "General") {
      activeCategory = q;
      activeLabel = label || q;
      // Actualizar estado UI
      status.textContent = "Cargando...";
      info.textContent = "";
      list.innerHTML = "";

      try {
        const data = await fetchNews(q);
        render(data.articles);
        status.textContent = "";
      } catch (err) {
        console.error(err);
        status.textContent = "Error cargando noticias.";
        info.textContent = "‚Äî";
      }
    }

    // Click en buscar: interpretar y cargar
    btnBuscar.onclick = () => {
      const raw = qInput.value.trim();
      const result = interpretQuery(raw);
      // Si es category, buscamos por el c√≥digo en ingl√©s.
      if (result.type === "category") {
        // marca el bot√≥n correspondiente (si existe)
        const btn = Array.from(cats.querySelectorAll("button")).find(b => b.dataset.cat === result.q);
        if (btn) setActiveButton(btn);
        load(result.q, result.label);
      } else {
        // texto libre: quitar selecci√≥n de botones
        setActiveButton(null);
        activeLabel = result.label;
        load(result.q, result.label);
      }
    };

    // Enter en input dispara b√∫squeda
    qInput.onkeydown = (e) => { if (e.key === "Enter") btnBuscar.click(); };

    // Inicial: marcar General y cargar
    (function init() {
      const defaultBtn = Array.from(cats.querySelectorAll("button")).find(b => b.dataset.cat === "general");
      if (defaultBtn) setActiveButton(defaultBtn);
      load("general", "General");
    })();
  </script>
</body>
</html>